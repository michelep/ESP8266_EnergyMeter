<!doctype html>
<html>
    <head>
	<meta charset="utf-8" />
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<meta name="description" content="Energy Meter" />
        <meta name="author" content="Michele <o-zone@zerozone.it> Pinassi" />
	<title>Energy Meter - %hostname%</title>
	<link rel="stylesheet" href="/pure-min.css">
	<link rel="stylesheet" href="/grids-responsive-min.css">
	<link rel="stylesheet" href="/styles.css">
	<script src="/jquery-3.5.1.min.js"></script>
    </head>
    <body>
	<div id="layout" class="pure-g">
	    <div class="sidebar pure-u-1 pure-u-md-1-4">
    		<div class="header">
        	    <h1 class="brand-title">Energy Meter</h1>
		    <div>&nbsp;</div>
        	    <h2 class="brand-tagline"><b>WiFi smart energy monitor</b>
			%fw_version%
		    </h2>
		</div>
	    </div>
        </div>
	<div class="content pure-u-1 pure-u-md-3-4">
    	    <div>
    		<div class="posts">
            	    <section class="post">
        		<div class="post-desctiption status-bar" id="status">
			    <img src="loader.gif">
			</div>
		    </section>
		</div>
    		<div class="posts">
		    <div class="pure-g">
    			<div class="pure-u-1 pure-u-md-1-4">
        		    <div class="rt-table">
            			<div class="rt-table-header" style="background:#006d77">
                		    <h2>Voltage</h2>
				</div>
                		<div class="rt-table-body" id="rt-v">
				    <img src="loader.gif">
                		</div>
        		    </div>
    			</div>
    			<div class="pure-u-1 pure-u-md-1-4">
        		    <div class="rt-table">
            			<div class="rt-table-header" style="background:#d62828">
                		    <h2>Current</h2>
            			</div>
                		<div class="rt-table-body" id="rt-i">
				    <img src="loader.gif">
                		</div>
        		    </div>
    			</div>
    			<div class="pure-u-1 pure-u-md-1-4">
        		    <div class="rt-table">
            			<div class="rt-table-header" style="background:#f3722c">
                		    <h2>Power</h2>
            			</div>
                		<div class="rt-table-body" id="rt-p">
				    <img src="loader.gif">
                		</div>
        		    </div>
    			</div>
    			<div class="pure-u-1 pure-u-md-1-4">
        		    <div class="rt-table">
            			<div class="rt-table-header" style="background:#43aa8b">
                		    <h2>Energy</h2>
            			</div>
                		<div class="rt-table-body" id="rt-e">
				    <img src="loader.gif">
                		</div>
        		    </div>
    			</div>
		    </div>
        	</div>
    		<div class="posts">
            	    <section class="post">
                	<header class="post-header">
                    	    <h2 class="post-title">BOARD CONFIGURATION</h2>
                	</header>
                	<div class="post-description">
			    <form method="POST" action="/post" class="pure-form pure-form-stacked">
				<fieldset>
				    <legend>Alarms</legend>
			    	    <div class="pure-g">
        			        <div class="pure-u-1 pure-u-md-1-3">
					    <label for="power_alarm">Power alarm</label>
            				    <input type="number" id="power_alarm" name="power_alarm" class="pure-u-23-24" value="%power_alarm%" min="1" max="9999" placeholder="trigger alarm when raised this power level (watts)"/>
    					</div>
				    </div>
				    <legend>WiFi and MQTT configuration</legend>
			    	    <div class="pure-g">
        			        <div class="pure-u-1 pure-u-md-1-3">
					    <label for="wifi_essid">SSID</label>
            				    <input type="text" id="wifi_essid" name="wifi_essid" class="pure-u-23-24" value="%wifi_essid%" required />
    					</div><div class="pure-u-1 pure-u-md-1-3">
					    <label for="wifi_password">PSK Key</label>
        				    <input type="password" id="wifi_password" name="wifi_password" class="pure-u-23-24" value="%wifi_password%"/>
			        	</div>
        				<div class="pure-u-1 pure-u-md-1-3">
            				    <label>WiFi Signal Power</label>
					    <p>%wifi_rssi% db</p>
        				</div>
        			    </div>
        			    <div class="pure_g">
        			        <div class="pure-u-1 pure-u-md-1-4">
					    <label for="broker_host">MQTT broker host</label>
            				    <input type="text" id="broker_host" name="broker_host" class="pure-u-23-24" value="%broker_host%"/>
    					</div><div class="pure-u-1 pure-u-md-1-4">
					    <label for="broker_port">MQTT broker port</label>
        				    <input type="number" id="broker_port" name="broker_port" class="pure-u-23-24" value="%broker_port%"/>
			        	</div><div class="pure-u-1 pure-u-md-1-4">
					    <label for="client_id">MQTT client ID</label>
        				    <input type="text" id="client_id" name="client_id" class="pure-u-23-24" value="%client_id%"/>
			        	</div><div class="pure-u-1 pure-u-md-1-4">
					    <label for="client_id">MQTT Timeout</label>
        				    <input type="number" id="broker_tout" min="30" max="3000" name="broker_tout" class="pure-u-23-24" value="%broker_tout%"/>
			        	</div>
        			    </div>
				</fieldset><fieldset>
				    <legend>System configuration</legend>
			    	    <div class="pure-g">
        			        <div class="pure-u-1 pure-u-md-1-3">
					    <label for="hostname">Hostname</label>
            				    <input type="text" id="hostname" name="hostname" class="pure-u-23-24" value="%hostname%" required />
    					</div><div class="pure-u-1 pure-u-md-1-3">
					    <label for="ntp_server">NTP server</label>
        				    <input type="text" id="ntp_server" name="ntp_server" class="pure-u-23-24" value="%ntp_server%"/>
			        	</div><div class="pure-u-1 pure-u-md-1-3">
					    <label for="ntp_timezone">NTP timezone</label>
        				    <input type="number" id="ntp_timezone" name="ntp_timezone" class="pure-u-23-24" value="%ntp_timezone%"/>
			        	</div>
				    </div>
			    	    <div class="pure-g">
        			        <div class="pure-u-1 pure-u-md-1-3">
					    <label for="admin_username">Username</label>
            				    <input type="text" id="admin_username" name="admin_username" class="pure-u-23-24" value="%admin_username%"/>
    					</div><div class="pure-u-1 pure-u-md-1-3">
					    <label for="admin_password">Password</label>
        				    <input type="text" id="admin_password" name="admin_password" class="pure-u-23-24" value="%admin_password%"/>
    					</div><div class="pure-u-1 pure-u-md-1-3">
					    <label for="formHostName">OTA updates</label>
					    <input type="checkbox" class="form-control" id="form_ota" name="ota_enable" checked="%ota_enable%" />
					</div>
				    </div>
				</fieldset>
				<div class="pure-button-group" role="group" aria-label="Configuration">
			    	    <button type="submit" class="pure-button button-success">SAVE</button>
			    	    <a href="/config.json" type="button" class="pure-button pure-button-primary">Config export</a>
			    	    <a href="/restart" type="button" class="pure-button button-warning">! Restart !</a>
				</div>
			    </form>
                	</div>
            	    </section>
        	</div>
        	<div class="footer">
            	    <div class="pure-menu pure-menu-horizontal">
                	<ul>
                    	    <li class="pure-menu-item"><a href="https://www.zerozone.it" class="pure-menu-link">My blog on zerozone.it</a></li>
                    	    <li class="pure-menu-item"><a href="https://github.com/michelep/" class="pure-menu-link">My code on Github</a></li>
                    	    <li class="pure-menu-item"><a href="https://twitter.com/michele_pinassi" class="pure-menu-link">Follow me on Twitter</a></li>
                	</ul>
            	    </div>
        	</div>
    	    </div>
	</div>
	<script>
function ajaxCall(action, value) {
    $.ajax({
	url: 'ajax',
        type: 'post',
	data: { action: "env" },
	dataType: 'json',
	timeout : 1000,
    }).fail(function(xhr, text, error) {
	$('#status').html('FAILED ('+error+'): device is connected?');
    }).done(function(data) {
	$('#status').html(data.status);
	$('#rt-v').html(data.v+'V');
	$('#rt-i').html(data.i+'A');
	$('#rt-p').html(data.p+'W');
	$('#rt-e').html(data.e+'Wh');
    });
    setTimeout(ajaxCall, 2000);
    return false;
}

$(document).ready(function(){
    ajaxCall();
});
	</script>
    </body>
</html>